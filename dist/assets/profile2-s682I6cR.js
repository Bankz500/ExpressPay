import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as d}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getAuth as m,onAuthStateChanged as u,updateProfile as p}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";import{getFirestore as f,getDoc as g,doc as l,setDoc as y}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";const h={apiKey:"AIzaSyA3OvFCz4sU4QnZAPnFrc_yzZezjzlzkgY",authDomain:"exprespay-26ac0.firebaseapp.com",projectId:"exprespay-26ac0",storageBucket:"exprespay-26ac0.firebasestorage.app",messagingSenderId:"933418932546",appId:"1:933418932546:web:1eaac518eecab2042390db",measurementId:"G-8ECL5E373T"},s=d(h),i=m(s),c=f(s);async function I(e){if(!e)return;const o=document.getElementById("email"),a=document.getElementById("name"),r=document.getElementById("profileImage");o.placeholder=e.email,o.value=e.email;try{const t=await g(l(c,"users",e.uid));if(t.exists()){const n=t.data();a.value=n.name||"No name set",a.placeholder=n.name||"No name set",r.src=n.photoURL||"https://via.placeholder.com/150"}else a.value=e.displayName||"No name set",a.placeholder=e.displayName||"No name set",r.src=e.photoURL||"https://via.placeholder.com/150"}catch(t){console.error("Error fetching user data:",t)}}window.onload=function(){document.getElementById("profileInfoCard").classList.remove("hidden"),u(i,I)};document.getElementById("imageUpload").addEventListener("change",async function(e){const o=e.target.files[0];if(o){const a=new FormData;a.append("file",o),a.append("upload_preset","photo_upload");try{const t=await(await fetch("https://api.cloudinary.com/v1_1/dkir5njcy/image/upload",{method:"POST",body:a})).json();if(console.log("Cloudinary response:",t),!t.secure_url){console.error("Cloudinary upload failed or pending status:",t),alert("Image upload failed. Please try again.");return}const n=i.currentUser;n&&(await y(l(c,"users",n.uid),{photoURL:t.secure_url},{merge:!0}),await p(n,{photoURL:t.secure_url}),document.getElementById("profileImage").src=t.secure_url,console.log("Updated Profile Image URL:",t.secure_url),alert("Profile image updated successfully!"))}catch(r){console.error("Error uploading image:",r),alert("Failed to upload image. Please try again.")}}});window.updateProfile=function(){const e=document.getElementById("saveChangesButton"),o=e.textContent;e.disabled=!0,e.textContent="Processing...",setTimeout(function(){const a=document.getElementById("name").value.trim();if(!a){alert("Please enter valid information for full name.");return}localStorage.setItem("fullName",a),alert("Profile updated successfully!"),e.disabled=!1,e.textContent=o},2e3)};
